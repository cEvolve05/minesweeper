import { VerticalBox, Button, TextEdit } from "std-widgets.slint";
import { Empty } from "@project/widget/empty.slint";
import { View } from "@project/widget/view.slint";

export enum Difficulty {
    Easy,
    Medium,
    Hard,
    Custom,
}

export struct GameConfig {
    width: int,
    height: int,
    mine_count: int,
}

export global SettingState {
    in-out property <Difficulty> difficulty: Difficulty.Easy;
    in-out property <int> custom-config-width: 9;
    in-out property <int> custom-config-height: 9;
    in-out property <int> custom-config-mine-count: 10;
}

component ConfigItemInt inherits HorizontalLayout {
    in property <string> text;
    in-out property <int> value;
    in property <int> min-value;
    in property <int> max-value;
    spacing: 8px;
    alignment: LayoutAlignment.space-around;
    function clamp-value() {
        if (value < min-value) {
            value = min-value;
        }
        if (value > max-value) {
            value = max-value;
        }
    }
    Text {
        width: 100px;
        text <=> text;
        horizontal-alignment: TextHorizontalAlignment.center;
        vertical-alignment: TextVerticalAlignment.center;
    }

    HorizontalLayout {
        spacing: 8px;
        Button {
            text: "-";
            clicked => {
                value -= 1;
                clamp-value();
            }
        }

        Text {
            width: 50px;
            text: value;
            vertical-alignment: TextVerticalAlignment.center;
            horizontal-alignment: TextHorizontalAlignment.center;
            TouchArea {
                scroll-event(event) => {
                    if (event.delta_y < 0) {
                        value -= 1;
                    } else if (event.delta_y > 0) {
                        value += 1;
                    }
                    clamp-value();
                    return EventResult.accept;
                }
            }
        }

        Button {
            text: "+";
            clicked => {
                value += 1;
                clamp-value();
            }
        }
    }
}

export component Setting inherits View {
    function difficulty-to-string(difficulty: Difficulty) -> string {
        if (difficulty == Difficulty.Easy) {
            return "Easy";
        }
        if (difficulty == Difficulty.Medium) {
            return "Medium";
        }
        if (difficulty == Difficulty.Hard) {
            return "Hard";
        }
        if (difficulty == Difficulty.Custom) {
            return "Custom";
        }
        return "Unknown";
    }

    VerticalLayout {
        padding: 8px;
        spacing: 8px;

        VerticalLayout {
            spacing: 8px;
            width: 100%;
            
            Text {
                text: "难度选择";
                font-weight: 900;
                font-size: 28px;
                horizontal-alignment: TextHorizontalAlignment.center;
                width: 100%;
                color: #2c3e50;
            }

            Text {
                text: "现在选择：" + difficulty-to-string(SettingState.difficulty);
                font-size: 18px;
                horizontal-alignment: TextHorizontalAlignment.center;
                width: 100%;
                color: #34495e;
                font-weight: 500;
            }

            Text {
                text: "（重新开始游戏后生效）";
                font-size: 14px;
                horizontal-alignment: TextHorizontalAlignment.center;
                width: 100%;
                color: #7f8c8d;
            }
        }

        Rectangle {
            height: 1px;
            width: 100%;
            background: #9baaa0ff;
        }

        VerticalLayout {
            spacing: 4px;
            width: 100%;
            
            Text {
                text: "\n请选择一个难度级别：";
                font-size: 16px;
                horizontal-alignment: TextHorizontalAlignment.left;
                width: 100%;
                color: #242323ff;
            }
            
            HorizontalLayout {
                spacing: 8px;
                padding: 8px;
                
                Button {
                    text: "Easy";
                    checkable: true;
                    checked: SettingState.difficulty == Difficulty.Easy;
                    clicked => { SettingState.difficulty = Difficulty.Easy; }
                }

                Button {
                    text: "Medium";
                    checkable: true;
                    checked: SettingState.difficulty == Difficulty.Medium;
                    clicked => { SettingState.difficulty = Difficulty.Medium; }
                }

                Button {
                    text: "Hard";
                    checkable: true;
                    checked: SettingState.difficulty == Difficulty.Hard;
                    clicked => { SettingState.difficulty = Difficulty.Hard; }
                }

                Button {
                    text: "Custom";
                    checkable: true;
                    checked: SettingState.difficulty == Difficulty.Custom;
                    clicked => { SettingState.difficulty = Difficulty.Custom; }
                }
            }
        }

        Rectangle {
            width: 100%;
            padding: 16px;
            background: #f1f4f7ff;
            
            VerticalLayout {
                spacing: 16px;
                width: 100%;

                Text {
                    text: "Custom 难度配置";
                    font-size: 24px;
                    horizontal-alignment: TextHorizontalAlignment.left;
                    width: 100%;
                }

                VerticalBox {
                    spacing: 16px;
                    padding: 8px;

                    HorizontalLayout {
                        spacing: 12px;
                        alignment: LayoutAlignment.center;

                        Text {
                            width: 120px;
                            text: "Width";
                            font-size: 16px;
                            horizontal-alignment: TextHorizontalAlignment.center;
                            vertical-alignment: TextVerticalAlignment.center;
                        }

                        HorizontalLayout {
                            spacing: 8px;
                            
                            // 减号按钮
                            Button {
                                text: "-";
                                clicked => { SettingState.custom-config.width -= 1; }
                            }
                            
                            Text {
                                width: 60px;
                                text: SettingState.custom-config.width;
                                font-size: 20px;
                                horizontal-alignment: TextHorizontalAlignment.center;
                                vertical-alignment: TextVerticalAlignment.center;
                            }
                            
                            // 加号按钮
                            Button {
                                text: "+";
                                clicked => { SettingState.custom-config.width += 1; }
                            }
                        }
                    }

                    HorizontalLayout {
                        spacing: 12px;
                        alignment: LayoutAlignment.center;
                        
                        Text {
                            width: 120px;
                            text: "Height";
                            font-size: 16px;
                            horizontal-alignment: TextHorizontalAlignment.center;
                            vertical-alignment: TextVerticalAlignment.center;
                        }
                        
                        HorizontalLayout {
                            spacing: 8px;
                            
                            // 减号按钮
                            Button {
                                text: "-";
                                clicked => { SettingState.custom-config.height -= 1; }
                            }
                            
                            Text {
                                width: 60px;
                                text: SettingState.custom-config.height;
                                font-size: 20px;
                                horizontal-alignment: TextHorizontalAlignment.center;
                                vertical-alignment: TextVerticalAlignment.center;
                            }
                            
                            // 加号按钮
                            Button {
                                text: "+";
                                clicked => { SettingState.custom-config.height += 1; }
                            }
                        }
                    }

                    HorizontalLayout {
                        spacing: 12px;
                        alignment: LayoutAlignment.center;

                        Text {
                            width: 120px;
                            text: "Mine Count";
                            font-size: 16px;
                            horizontal-alignment: TextHorizontalAlignment.center;
                            vertical-alignment: TextVerticalAlignment.center;
                        }
                        
                        HorizontalLayout {
                            spacing: 8px;
                            
                            // 减号按钮
                            Button {
                                text: "-";
                                clicked => { SettingState.custom-config.mine-count -= 1; }
                            }
                            
                            Text {
                                width: 60px;
                                text: SettingState.custom-config.mine-count;
                                font-size: 20px;
                                horizontal-alignment: TextHorizontalAlignment.center;
                                vertical-alignment: TextVerticalAlignment.center;
                            }
                            
                            // 加号按钮
                            Button {
                                text: "+";
                                clicked => { SettingState.custom-config.mine-count += 1; }
                            }
                        }
                    }
                }
                
                Text {
                    text: "建议：宽度和高度范围为 9-24，地雷数量不超过总格子数的 20%";
                    font-size: 12px;
                    horizontal-alignment: TextHorizontalAlignment.center;
                    width: 100%;
                }
            }
        }
    }
}
