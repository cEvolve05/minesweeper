import { VerticalBox, Button, TextEdit } from "std-widgets.slint";
import { Empty } from "@project/widget/empty.slint";
import { View } from "@project/widget/view.slint";

export enum Difficulty {
    Easy,
    Medium,
    Hard,
    Custom,
}

export struct GameConfig {
    width: int,
    height: int,
    mine_count: int,
}

export global SettingState {
    in-out property <Difficulty> difficulty: Difficulty.Easy;
    in-out property <int> custom-config-width: 9;
    in-out property <int> custom-config-height: 9;
    in-out property <int> custom-config-mine-count: 10;
}

component ConfigItemInt inherits HorizontalLayout {
    in property <string> text;
    in-out property <int> value;
    in property <int> min-value;
    in property <int> max-value;
    spacing: 8px;
    alignment: LayoutAlignment.space-around;
    function clamp-value() {
        if (value < min-value) {
            value = min-value;
        }
        if (value > max-value) {
            value = max-value;
        }
    }
    Text {
        width: 100px;
        text <=> text;
        horizontal-alignment: TextHorizontalAlignment.center;
        vertical-alignment: TextVerticalAlignment.center;
    }

    HorizontalLayout {
        spacing: 8px;
        Button {
            text: "-";
            clicked => {
                value -= 1;
                clamp-value();
            }
        }

        Text {
            width: 50px;
            text: value;
            vertical-alignment: TextVerticalAlignment.center;
            horizontal-alignment: TextHorizontalAlignment.center;
            TouchArea {
                scroll-event(event) => {
                    if (event.delta_y < 0) {
                        value -= 1;
                    } else if (event.delta_y > 0) {
                        value += 1;
                    }
                    clamp-value();
                    return EventResult.accept;
                }
            }
        }

        Button {
            text: "+";
            clicked => {
                value += 1;
                clamp-value();
            }
        }
    }
}

export component Setting inherits View {
    function difficulty-to-string(difficulty: Difficulty) -> string {
        if (difficulty == Difficulty.Easy) {
            return "Easy";
        }
        if (difficulty == Difficulty.Medium) {
            return "Medium";
        }
        if (difficulty == Difficulty.Hard) {
            return "Hard";
        }
        if (difficulty == Difficulty.Custom) {
            return "Custom";
        }
        return "Unknown";
    }
    //difficulty selection
    VerticalLayout {
        padding: 8px;
        spacing: 8px;
        alignment: LayoutAlignment.start;
        width: 288px;
        Text {
            text: "难度选择";
            font-weight: 800;
            font-size: 24px;
        }

        Text {
            text: "现在选择：" + difficulty-to-string(SettingState.difficulty) + "\n（重新开始游戏后生效）";
        }

        HorizontalLayout {
            padding: 8px;
            spacing: 8px;
            Button {
                text: "Easy";
                clicked => {
                    SettingState.difficulty = Difficulty.Easy;
                }
            }

            Button {
                text: "Medium";
                clicked => {
                    SettingState.difficulty = Difficulty.Medium;
                }
            }

            Button {
                text: "Hard";
                clicked => {
                    SettingState.difficulty = Difficulty.Hard;
                }
            }

            Button {
                text: "Custom";
                clicked => {
                    SettingState.difficulty = Difficulty.Custom;
                }
            }
        }

        Text {
            text: "Custom 难度配置";
            font-weight: 800;
            font-size: 24px;
        }
        //custom selection with grid size and mine count
        VerticalLayout {
            padding: 8px;
            spacing: 8px;
            ConfigItemInt {
                text: "Width";
                value <=> SettingState.custom-config-height;
                min-value: 1;
                max-value: 50;
            }

            ConfigItemInt {
                text: "Height";
                value <=> SettingState.custom-config-height;
                min-value: 1;
                max-value: 50;
            }

            ConfigItemInt {
                text: "Mine Count";
                value <=> SettingState.custom-config-mine-count;
                min-value: 1;
                max-value: 50;
            }
        }
    }
}
